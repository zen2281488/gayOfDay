# Winner of Day Bot

VK-бот сообщества, который выбирает «победителя дня» по истории чата и умеет отвечать как чатбот через LLM.

## Возможности
- выбор «победителя дня» с причиной и хранением результата в SQLite
- лидерборд за месяц и за все время
- поддержка Groq и Venice, смена провайдера/модели на лету
- расписание запуска игры и таймер лидерборда (МСК)
- чатбот по упоминанию и в ЛС администратора
- Docker Compose запуск

## Быстрый старт (Docker)

1) Создай `.env`
2) Запусти контейнер:

```bash
docker compose up -d --build
```

3) Логи:

```bash
docker compose logs -f vk-bot
```

## Конфигурация (.env)

Минимум для запуска:
```
VK_TOKEN=vk1.a.***
USER_PROMPT_TEMPLATE=Лог чата:\n{{CHAT_LOG}}\n\nКто из них победитель дня? Ответ — строго JSON.
```

LLM и чатбот:
```
LLM_PROVIDER=groq|venice
GROQ_API_KEY=gsk_***
GROQ_MODEL=llama-3.3-70b-versatile
GROQ_TEMPERATURE=0.9

VENICE_API_KEY=vnk_***
VENICE_MODEL=venice-uncensored
VENICE_BASE_URL=https://api.venice.ai/api/v1/
VENICE_TEMPERATURE=0.9

CHATBOT_ENABLED=true
CHAT_SYSTEM_PROMPT=Отвечай кратко и по-русски.
CHAT_MAX_TOKENS=300
CHAT_RESPONSE_MAX_CHARS=600
```

Ограничения доступа:
```
ALLOWED_PEER_ID=2000000001,2000000002
ADMIN_USER_ID=123456789
```

## Команды
Команды нечувствительны к регистру.

Игра:
- `/кто` — найти победителя дня
- `/сброс` — сброс результата сегодня
- `/лидерборд` — лидерборд месяца и все время
- `/время 14:00` — установить авто-запуск (МСК)
- `/сброс_времени` — удалить таймер
- `/таймер_лидерборда 05-18-30` — таймер лидерборда (МСК)
- `/сброс_таймера_лидерборда` — сброс таймера лидерборда

Настройки LLM:
- `/провайдер groq|venice`
- `/список_моделей <провайдер>`
- `/установить_модель <провайдер> <id>`
- `/установить_ключ <провайдер> <ключ>`
- `/установить_температуру <0.0-2.0>`

Промпт:
- `/промт` — показать текущий USER_PROMPT_TEMPLATE
- `/промт <текст>` — обновить USER_PROMPT_TEMPLATE (в памяти)

## Примечания
- База SQLite хранится в `./data/chat_history.db`.
- Главный файл запуска в контейнере: `bot.py`.

## Лицензия
MIT, см. `LICENSE`.
